#  Cassandra介绍





## cassandra介绍优点、缺点、设计及运维总结

cassandra 是一套开源的分布式NoSQL数据库系统，

是一堆数据库节点共同构成的一个分布式网络服务，对cassandra 的一个写操作，会被复制到其他节点，读操作也会被路由到某个节点上去，对于cassandra 集群来说，扩展非常简单， 在集群中添加节点即可。



Cassandra集群没有中心节点，各个节点的地位完全相同，它们通过一种叫做gossip的协议维护集群的状态。通过gossip，每个节点都能知道集群中包含哪些节点，以及这些节点的状态，这使得Cassandra集群中的任何一个节点都可以完成任意key的路由，任意一个节点不可用都不会造成灾难性的后果。



### 三大优点：

- *格式的灵活性*，像文档存储在系统运行时随意添加或移除字段。
- 真正的高可扩展性， 纯粹意义的水平扩展、线性可扩展、提高吞吐量、增加集群节点数量，因此可以保证快速的响应。
- 多数据中心识别 ， 避免一个数据中心起火，一个备用的数据中心至少有每一条数据的完全复制。

### cassandra 支持事务

- 设置键可以范围查询
- 列表数据结构，可将超级列添加到5五维，用以索引 ，
- 分布式写操作
- 基于column 的结构化数据

### cassandra 核心组件

- GossIp
- ParTlTloner : 负责在集群中 分配数据， 使用Hash作为主键
- 复制策略：  确定哪个节点放置数据，以及复制的份数，
- cassandra.yaml：主配置文件，设置集群的初始化配置、表的缓存参数、调优参数和资源使用、超时设定、客户端连接、备份和安全。

### cassandra 数据库设计和维护总结

1. 分区字段设计时选用 timeuuid 字段， 比如每日零点 或者 每小时的时间戳
2. 索引字段根据需求设计
3. 使用索引时的查询条件，务必带上分区字段的查询条件，否则会去所有分区的索引中查询，效率低下，查询超出10w个墓碑，会抛出异常。
4. 高基字段不上索引， 比如男女、true /false
5. 由于cassandra 的read repair 机制， 执行大量删除操作后出现read timeout 需要在每台cassandra 的bin 目录下进行

```shell
./nodetool flush 
./nodetool $keyspace $table 强制合并sstable
```

1. 如果cassandra 出现不同数据节点一致性错误，需要执行

```shell
./nodetool repair $keyspace $table
```

1. 如果repair 还不能解决问题需要执行   ./sstablescrub $ kyespace $table  清洗掉损坏的数据，（注意，此操作中断容易造成数据损坏，最好执行前做好快照）
2. cassandra 默认开启啦安全模式，执行drop、truncate 等敏感字段会对数据做一次快照，过多快照会导致cassandra 启动时遍历目录环节话费过多时间，最终可能导致几个小时才能启动，
   这个时候需要执行   ./nodetool cleansnapshot $keyspace

cassandra 基础使用可参考： https://blog.csdn.net/doc_sgl/article/details/52888574





## 6.1 一致性等级



Cassandra采用了最终一致性。最终一致性是指分布式系统中的一个数据对象的多个副本尽管在短时间内可能出现不一致，但是经过一段时间之后，这些副本最终会达到一致。



Cassandra 的一个特性是可以让用户指定每个读/插入/删除操作的一致性级别（consistency level）。Casssandra API 目前支持以下几种一致性级别：



ZERO：只对插入或者删除操作有意义。负责执行操作的节点把该修改发送给所有的备份节点，但是不会等待任何一个节点回复确认，因此不能保证任何的一致性。



ONE：对于插入或者删除操作，执行节点保证该修改已经写到一个存储节点的 commit log 和 Memtable 中；对于读操作，执行节点在获得一个存储节点上的数据之后立即返回结果。



QUORUM：假设该数据对象的备份节点数目为 n。对于插入或者删除操作，保证至少写到 n/2+1 个存储节点上；对于读操作，向 n/2+1 个存储节点查询，并返回时间戳最新的数据。



ALL：对于插入或者删除操作，执行节点保证n（n为replication factor）个节点插入或者删除成功后才向client返回成功确认消息，任何一个节点没有成功，该操作均失败；对于读操作，会向n个节点查询，返回时间戳最新的数据，同样，如果某个节点没有返回数据，则认为读失败。

[
](https://blog.csdn.net/aa1215018028/article/details/81283799)